<AppBarModifier title="Login" />

<div class="wrapper">
  <p>Você é:</p>
  <h1>{user.name}</h1>
  <p class="desc"> {user.height} de Altura, {user.mass} de Massa</p>
  <p class="desc">{user.gender}, {user.birth_year}</p>
  <p class="desc">{user.homeworld}</p>
  <Button size="small" on:click="refs.printable.print()" shortcut="enter">Sim, sou eu</Button>
  <Button size="small" bgColor="#425963" on:click="buscaUser()">Não</Button>
    <br/><br/>
  <Button width="100%" secondary bgColor="#425963">Ver todos</Button>
</div>

<Printable ref:printable>

  <h1>
    {user.name}
  </h1>

</Printable>

<script>
  import http from '@mamba/pos/api/http.js';

  export default {
    components: {
      AppBarModifier: '@mamba/appbar/Modifier.html',
      Button: '@mamba/button/Button.html',
      Printable: '@mamba/printable',
    },
    data() {
      return {
        user: {
          name: 'Luke Skywalker',
          height: '172',
          mass: '77',
          gender: 'Masculino',
          birth_year: '1B77',
          species: '',
          homeworld: 'Tatooine',
        }
      };
    },
    methods: {
      buscaUser() {
        
        let user_id = Math.floor(Math.random() * 88) + 1
        
        let requestConfig = {
          url: `https://swapi.co/api/people/${user_id}/`,
          method: 'GET'
        }

        // Busca info do usuário        
        console.log('%cIniciando requisição do usuário...', 'color: #FFFF33')
        http.send(requestConfig)
          .then(result => {

            const parsed = JSON.parse(result)

            function capitalizeFirstLetter(string) {
                return string.charAt(0).toUpperCase() + string.slice(1);
            }

            // Localiza o objeto
              const { user } = this.get()

            user.name = parsed.name
            user.height = parsed.height == 'unknown' ? 'Desconhecido' : parsed.height
            user.mass = parsed.mass == 'unknown' ? 'Desconhecido' : parsed.mass
            user.gender = parsed.gender == 'unknown' ? 'Desconhecido' : capitalizeFirstLetter(parsed.gender)
            user.birth_year = parsed.birth_year == 'unknown' ? 'Desconhecido' : parsed.birth_year

            // Busca nome do Planeta
            console.log('%cIniciando requisição do Planeta...', 'color: #FFFF33')
            http.send({
              url: parsed.homeworld,
              method: 'GET'
            })
            .then(result => {

              const parsedPlanet = JSON.parse(result)
              
              user.homeworld = parsedPlanet.name == 'unknown' ? 'Desconhecido' : parsedPlanet.name
              
              this.set({ user })

            })
          })
      },
    },
  };
</script>

<style type="text/postcss">
  .wrapper {
    padding: 10px;
    text-align: center;
  }

  p {
    font-size: 14px;
    font-weight: normal;
  }

  h1 {
    font-weight: bold;
    margin: 5px 0;
  }

  .desc {
    margin-bottom: 5px;
  }
</style>
